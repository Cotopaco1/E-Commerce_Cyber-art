let formularioDatos,validado=!1,montoTotal=0,carritoDeCompra=[];const usuario={id:null,nombre:"",apellidos:"",datos_de_contacto:{telefono:"",email:"",direccion:"",ciudad:"",departamento:""}};let metodo_pago="",paso=1;const path=window.location.pathname;function iniciarApp(){eventoInputs(),eventoMenu(),subrayarPaginaActual(),eventoCarritoUserBoton(),"/"===path&&(agregarFixed(),eventoCuadros(),consultarApiCuadros()),"/carrito_de_compras"===path&&(agregarFixed(),crearOpcionesEnSelected(),recuperarCarritoCompras(),tabs(),mostrarSeccion(),agregar_evento_botones_paginacion(),inputMetodosDePago(),formulario_evento()),"/crear_cuenta"!==path||eventos_crear_cuenta()}function eventos_crear_cuenta(){document.getElementById("formulario").addEventListener("submit",crear_cuenta);document.getElementById("boton_crear_cuenta").addEventListener("click",activar_evento_submit_en_crear_cuenta),document.querySelectorAll(".input").forEach((e=>{e.addEventListener("blur",verificar_input)}))}function verificar_input(e){const t=e.target.value,o=document.querySelector(`#error${e.target.id}`);if(""===t){if(o)return;const t=document.createElement("P");t.setAttribute("id",`error${e.target.id}`),t.textContent=`El ${e.target.id} es obligatorio`,e.target.insertAdjacentElement("afterend",t)}else o&&o.remove()}function crear_cuenta(e){console.log(e.target),e.preventDefault();enviar_formulario_para_crear_cuenta(crear_objeto_con_datos_de_formulario(e)).then(validar_respuesta_envio_formulario_crear_cuenta)}function validar_respuesta_envio_formulario_crear_cuenta(e){if(e.respuesta){document.querySelector("#mensaje").innerHTML="",Swal.fire({title:"Buen trabajo!",text:`${e.mensaje}`,icon:"success",fontsize:"5rem"}).then((()=>{window.location.href="http://localhost:3000/login"}))}else{const t=document.querySelector("#mensaje");t.innerHTML="",e.alertas.error.forEach((e=>{const o=document.createElement("P");o.textContent=e,o.classList.add("mensaje_de_error"),t.appendChild(o)}))}}async function enviar_formulario_para_crear_cuenta(e){try{getFechaActualFormateada();const t="http://localhost:3000/api/login/crear_cuenta",o={method:"post",body:JSON.stringify(e)},a=await fetch(t,o);return await a.json()}catch(e){console.log(e)}}function activar_evento_submit_en_crear_cuenta(){const e=document.getElementById("formulario"),t=new Event("submit",{bubbles:!0,cancelable:!0});e.dispatchEvent(t)}function contenedorMetodoPagoEvento(){document.querySelectorAll(".contenedor_metodo_pago").forEach((e=>{e.addEventListener("click",(e=>{const t=e.target.dataset.metodoPago;metodo_pago=t,mostrar_informacion_metodo_pago()}))}))}function inputMetodosDePago(){document.querySelectorAll(".input_radio_metodo_pago").forEach((e=>{e.addEventListener("click",(e=>{const t=e.target.dataset.metodoPago;metodo_pago=t,mostrar_informacion_metodo_pago()}))}))}function mostrar_informacion_metodo_pago(){const e=document.createElement("DIV");e.classList.add("contenedor_crear_pedido");const t=document.querySelector(".contenedor_crear_pedido");if(t&&t.remove(),"transferencia"===metodo_pago){const t=document.querySelector("[data-metodo-pago='transferencia'");return e.innerHTML='<button class="boton_crear_pedido boton">Terminar pedido</button>\n            <p class="crear_pedido_descripcion">Listo... Selecciona crear pedido para\n                crear la orden, una vez tengas la orden realizada, solo falta realizar\n                el pago y empezaremos a realizar y despachar tu pedido... ðŸ˜Ž\n            </p>',t.appendChild(e),metodo_pago="transferencia",void document.querySelector(".boton_crear_pedido").addEventListener("click",crear_pedido)}if("pse"===metodo_pago){const t=document.querySelector("[data-metodo-pago='pse'");return e.innerHTML="<p>Todavia no hemos habilitado transferencia PSE... esperalo pronto :D</p>",metodo_pago="pse",void t.appendChild(e)}}function obtenerValueElementById(e){return document.getElementById(e).value}async function crear_pedido(){try{const e=getFechaActualFormateada(),t={carritoDeCompra:carritoDeCompra,pedidos:{fecha:e,direccion:formularioDatos.direccion,monto_total:montoTotal,departamento:formularioDatos.departamento,ciudad:formularioDatos.ciudad,metodo_pago:metodo_pago,informacion_adicional:formularioDatos.informacion_extra},usuario:{nombre:formularioDatos.nombre,apellido:formularioDatos.apellido,email:formularioDatos.email,telefono:formularioDatos.telefono}},o="http://localhost:3000/api/crear_orden";jsonData=JSON.stringify(t);const a={method:"POST",body:jsonData};console.log(t);const r=await fetch(o,a),n=await r.json();console.log(n),n.exito&&Swal.fire({icon:"success",title:"Pedido creado",text:"El pedido ha sido guardado con exito",button:"OK"}).then((()=>{mostrar_instrucciones_despues_de_pago(n)}))}catch(e){console.log(e),Swal.fire({icon:"error",title:"Ha habido un error",text:"El pedido no se ha podido crear.."})}}function mostrar_instrucciones_despues_de_pago(e){document.querySelector("main").innerHTML=`\n    <h1>Gracias por tu compra!</h1>\n    <div class="div_instrucciones_pago contenedor">\n    <h2>Instrucciones a seguir</h2>\n    <div class="contenedorInstrucciones">\n        <p>Consigna a nuestra cuenta bancolombia #: <span>412514</span></p>\n        <p>Manda un screenshot a nuestro wp #124123123312 con el pedido # <span>${e.pedidoId}</span></p>\n        <p>Recibe tus productos en la puerta de tu casa...!</p>\n    </div>\n    <div class="resumenCompra"></div>\n    <h2>Resumen de tu pedido</h2>\n    <p>El pedido quedo a nombre de : <span> ${e.nombre} </span>  </p>\n    <p>El costo total a pagar es de : <span> ${parseInt(e.costo_total).toLocaleString()} </span></p>\n    <p>Los productos que te mandaremos son: ....</p>\n    <p>La direccion a la que te mandaremos los productos es: <span>${e.direccion}</span> </p>\n    </div>\n    `}function formulario_evento(){document.getElementById("formulario_carrito_de_compras").addEventListener("submit",(e=>{e.preventDefault();const t=crear_objeto_con_datos_de_formulario(e);validar_formulario_informacion_para_pedido(t).then((e=>{e?(validado=!0,formularioDatos=t,cambiarSeccionAdelante()):validado=!1}))}))}function crear_objeto_con_datos_de_formulario(e){return Object.fromEntries(new FormData(e.target))}async function validar_formulario_informacion_para_pedido(e){try{jsonData=JSON.stringify(e);const t="http://localhost:3000/api/validar_formulario",o={method:"POST",body:jsonData};console.log(e);const a=await fetch(t,o),r=await a.json();if(!r.error)return!0;{const e=document.querySelector("#alertas");for(;e.firstChild;)e.removeChild(e.firstChild);r.error.forEach((t=>{const o=document.createElement("P");return o.classList.add("alerta","error"),o.textContent=t,e.appendChild(o),!1}))}}catch(e){const t=document.querySelector("#alertas"),o=document.createElement("P");o.textContent=e,t.appendChild(o)}}function tabs(){document.querySelectorAll(".tabs button").forEach((e=>{e.addEventListener("click",(function(e){if("3"===e.target.dataset.paso){if(!activar_evento_submit_en_formulario_carrito_compras())return}paso=parseInt(e.target.dataset.paso),mostrarSeccion()}))}))}function mostrarSeccion(){let e=document.querySelector(".actual");const t=document.querySelector("#anterior"),o=document.querySelector("#siguiente");if(3===paso){const e=document.querySelector("#alertas");for(;e.firstChild;)e.removeChild(e.firstChild);if(!validado){return void(document.getElementById("alertas").innerHTML="<p class='alerta error'> Faltan datos por rellenar</p>")}console.log("el usuario esta validado, pasando a la seccion 3"),o.classList.add("hidden")}if(e){e.classList.remove("actual"),e.classList.add("ocultar");const t=document.querySelector(".hidden");t&&t.classList.remove("ocultar")}1===paso&&t.classList.add("hidden"),2===paso&&(t.classList.remove("hidden"),o.classList.remove("hidden"));let a=document.querySelector(`#paso-${paso}`);console.log(a,paso),a.classList.add("actual"),a.classList.remove("ocultar")}function crearOpcionesEnSelected(){const e=document.querySelector("#departamento");getDepartamentosColombia().then((t=>{t.forEach((t=>{const o=document.createElement("OPTION");o.textContent=t.name,o.value=t.name,o.dataset.departamentoId=t.id,e.appendChild(o)}))})),e.addEventListener("change",eventoSelect)}function eventoSelect(e){get_ciudades_de_un_departamento(e.target.options[e.target.selectedIndex].attributes["data-departamento-id"].value).then((e=>{crear_options_de_ciudad(e),console.log(e)}))}function crear_options_de_ciudad(e){const t=document.querySelector("#ciudad");e.forEach((e=>{const o=document.createElement("OPTION");o.textContent=e.name,o.value=e.name,o.dataset.ciudadId=e.id,t.appendChild(o)})),t.removeAttribute("disabled")}async function get_ciudades_de_un_departamento(e){try{const t=`https://api-colombia.com/api/v1/Department/${e}/cities`,o=await fetch(t);return await o.json()}catch(e){console.log(e)}}document.addEventListener("DOMContentLoaded",(function(){iniciarApp()}));let departamentos={};async function getDepartamentosColombia(){try{const e="https://api-colombia.com/api/v1/Department",t=await fetch(e);return await t.json()}catch(e){console.log(e)}}async function recuperarCarritoCompras(){try{const e="http://localhost:3000/api/cuadros/guardar_carrito_compras",t=await fetch(e),o=await t.json();carritoDeCompra=o.carritoDeCompra,montoTotal=o.montoTotal,mostrarCarritoDeCompras()}catch(e){console.log(e)}}function mostrarCarritoDeCompras(){const e=document.querySelector(".contenedorProductosFormulario"),t=document.querySelector("#tbody");for(;t.firstChild;)t.removeChild(t.firstChild),e.firstChild&&e.removeChild(e.firstChild);if(!carritoDeCompra.length>=1){const t=document.createElement("P");return t.classList.add("parrafoCarritoVacio"),t.innerHTML="El carrito esta vacio ... <br /> Lo sentimos selecciona algo para poder seguir con alguna compra ...  ðŸ˜­",void e.appendChild(t)}const o=document.getElementById("tbody");carritoDeCompra.forEach((e=>{const{id:t,nombre:a,precio:r,descripcion:n,size:c,disponible:i,imagen:d,cantidad:s}=e;document.createElement("DIV").classList.add("interfazCampo");const l=document.createElement("P");l.textContent=a,l.classList.add("nombre-producto");const u=document.createElement("P");u.textContent=`$${parseInt(r).toLocaleString()}`,u.classList.add("precio-producto");const m=document.createElement("P");m.textContent=`Cantidad: ${s}`,m.classList.add("cantidad_producto");const p=document.createElement("BUTTON");p.classList.add("botonChico"),p.textContent="+",p.addEventListener("click",(function(){agregarCantidad(e,!0)}));const f=document.createElement("BUTTON");f.classList.add("botonChicoRojo"),f.textContent="-",f.addEventListener("click",(function(){restarCantidad(e,!0)}));const C=document.createElement("P");C.innerHTML=`<span>TamaÃ±o: </span> ${c}`;const _=document.createElement("P");_.classList.add("descripcion-producto"),_.textContent=n;const h=document.createElement("DIV");h.classList.add("iconoDiv");const g=document.createElement("I");g.classList.add("fa-solid","fa-trash"),g.dataset.idProducto=t,g.addEventListener("click",(function(e){eliminarProducto(e.target.dataset.idProducto)})),h.appendChild(g);const v=document.createElement("DIV");v.classList.add("infoProductoCarrito"),v.appendChild(l),v.appendChild(C),v.appendChild(_);const E=document.createElement("DIV");E.classList.add("cantidad_producto_div"),E.appendChild(p),E.appendChild(f),E.appendChild(h);const b=document.createElement("IMG");b.src=`/img/${d}`;const L=r*s,y=document.createElement("P");y.textContent=`$${L.toLocaleString()}`,y.classList.add("precio-total-produto");const D=document.createElement("TR"),S=document.createElement("TD");S.classList.add("tabla_DetallesDelProducto"),S.appendChild(b),S.appendChild(v);const T=document.createElement("TD");T.appendChild(m),T.appendChild(E);const I=document.createElement("TD");I.appendChild(u);const q=document.createElement("TD");q.appendChild(y),D.appendChild(S),D.appendChild(T),D.appendChild(I),D.appendChild(q),o.appendChild(D)}));const a=document.createElement("P");a.classList.add("parrafoMontoTotal"),montoTotal=sumarProductosCarrito(),a.innerHTML=`<span>Monto Total:</span> $${montoTotal.toLocaleString()} COP`,e.appendChild(a)}function agregar_evento_botones_paginacion(){anterior=document.querySelector("#anterior"),siguiente=document.querySelector("#siguiente"),siguiente.addEventListener("click",cambiarSeccionAdelante),anterior.addEventListener("click",cambiarSeccionAtras)}function activar_evento_submit_en_formulario_carrito_compras(){const e=document.getElementById("formulario_carrito_de_compras"),t=new Event("submit",{bubbles:!0,cancelable:!0});e.dispatchEvent(t)}function cambiarSeccionAdelante(e){(2!==paso||(activar_evento_submit_en_formulario_carrito_compras(),validado))&&3!==paso&&(paso++,mostrarSeccion())}function cambiarSeccionAtras(){1!==paso&&(paso--,mostrarSeccion())}function eliminarProducto(e){carritoDeCompra.forEach((t=>{if(t.id===e){const e=carritoDeCompra.indexOf(t.id);carritoDeCompra.splice(e,1),console.log(carritoDeCompra),mostrarCarritoDeCompras()}}))}async function guardar_carrito_en_session(){try{const e=getFechaActualFormateada(),t={carritoDeCompra:carritoDeCompra,userData:{usuarioID:usuario.id},fecha:e,status:"pendiente",monto_total:montoTotal,metodo_pago:metodo_pago},o="http://localhost:3000/api/cuadros/guardar_carrito_compras";jsonData=JSON.stringify(t);const a={method:"POST",body:jsonData};console.log(t);const r=await fetch(o,a),n=await r.json();console.log(n),n.resultado&&Swal.fire({icon:"success",title:"Pedido creado correctamente",text:"El pedido ah sido creado crrectamente, a continuacion lee lo siguiente",button:"OK"}).then((()=>{window.location.href="/carrito_de_compras"}))}catch(e){console.log(e),Swal.fire({icon:"error",title:"Ha habido un error",text:"El pedido no se ha podido crear.."})}}function getFechaActualFormateada(){const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}:${String(e.getSeconds()).padStart(2,"0")}`}async function consultarApiCuadros(){try{const e="http://localhost:3000/api/cuadros/getcuadros",t=await fetch(e);imprimirResultadosApi(await t.json())}catch(e){console.log(e)}}function imprimirResultadosApi(e){e.forEach((e=>{const{descripcion:t,disponible:o,id:a,imagen:r,nombre:n,precio:c,size:i}=e,d=document.getElementById("cuadros"),s=document.createElement("DIV");s.classList.add("cuadro");const l=document.createElement("DIV");l.classList.add("imagenCuadroDiv"),l.style.backgroundImage=`url(/img/${r})`;const u=document.createElement("DIV");u.classList.add("cuadro-info"),u.dataset.idCuadro=a;const m=document.createElement("P");m.classList.add("nombre-cuadro"),m.textContent=n;const p=document.createElement("P");p.classList.add("precio-cuadro"),p.textContent=c,u.appendChild(m),u.appendChild(p),crearBotonComprarActual(u,e),l.appendChild(u),s.appendChild(l),d.appendChild(s)}))}function eventoCuadros(){cuadros=document.querySelectorAll(".imagenCuadroDiv"),cuadros.forEach((e=>{e.addEventListener("mouseenter",crearBotonComprar),e.addEventListener("mouseleave",eliminarBotonComprar)}))}function crearBotonComprarActual(e,t){const o=document.createElement("DIV"),a=document.createElement("BUTTON");a.classList.add("boton"),a.textContent="Agregar al carrito",o.appendChild(a),e.appendChild(o),a.addEventListener("click",(function(){agregarAlCarrito(t)}))}function agregarAlCarrito(e){if("cantidad"in e){const{id:t}=e;let o;carritoDeCompra.forEach((e=>{t===e.id&&(o=e)}));const a=carritoDeCompra.indexOf(o);carritoDeCompra[a].cantidad=carritoDeCompra[a].cantidad+1}else e.cantidad=1,carritoDeCompra.push(e);actualizarInterfazCarritoCompra()}function removeInterfazDinamico(e,t){t.remove(),e.target.removeEventListener("click",removeInterfaz)}function eventoCarritoUserBoton(){const e=document.querySelector(".carritoCompra"),t=document.querySelector(".userBoton");e.addEventListener("click",mostrarInterfazCarritoCompras),t.addEventListener("click",mostrarInterfazCarritoCompras)}function mostrarInterfazCarritoCompras(){actualizarInterfazCarritoCompra();const e=document.querySelector(".modalCarrito"),t=document.querySelector("#carritoDeCompras");e.appendChild(t),esconderScroll()}function actualizarInterfazCarritoCompra(){const e=document.querySelector(".modalCarrito");e&&e.remove(),crearModal();const t=document.querySelector(".contenedorCarritoCompras");if(!carritoDeCompra.length>=1){const e=document.createElement("P");return e.classList.add("parrafoCarritoVacio"),e.textContent="El carrito esta vacio ...",void t.appendChild(e)}for(;t.firstChild;)t.removeChild(t.firstChild);carritoDeCompra.forEach((e=>{const{id:o,nombre:a,precio:r,descripcion:n,size:c,disponible:i,imagen:d,cantidad:s}=e,l=document.createElement("DIV");l.classList.add("interfazCampo");const u=document.createElement("P");u.textContent=a,u.classList.add("nombre-producto");const m=document.createElement("P");m.textContent=r,m.classList.add("precio-producto");const p=document.createElement("P");p.textContent=`Cantidad: ${s}`;const f=document.createElement("BUTTON");f.classList.add("botonChico"),f.textContent="+",f.addEventListener("click",(function(){agregarCantidad(e)}));const C=document.createElement("BUTTON");C.classList.add("botonChicoRojo"),C.textContent="-",C.addEventListener("click",(function(){restarCantidad(e)}));const _=document.createElement("DIV");_.classList.add("infoProductoCarrito"),_.appendChild(u),_.appendChild(m),_.appendChild(p),_.appendChild(f),_.appendChild(C),crearBotonBorrar(_,o,e);const h=document.createElement("IMG");h.src=`/img/${d}`,l.appendChild(_),l.appendChild(h),t.appendChild(l)}));const o=document.createElement("P");o.classList.add("parrafoMontoTotal"),montoTotal=sumarProductosCarrito(),o.textContent=`Monto Total: $${montoTotal.toLocaleString()} pesos Colombianos`,t.appendChild(o);const a=document.createElement("BUTTON");a.classList.add("botonComprar"),a.textContent="Comprar",a.addEventListener("click",guardar_carrito_en_session),t.appendChild(a)}function sumarProductosCarrito(){let e=0;return carritoDeCompra.forEach((t=>{let o=parseInt(t.precio)*t.cantidad;e+=o})),e}function actualizar_resumen_de_carrito_compras(){}function agregarCantidad(e,t=!1){const o=carritoDeCompra.indexOf(e);carritoDeCompra[o].cantidad++,t?mostrarCarritoDeCompras():actualizarInterfazCarritoCompra()}function restarCantidad(e,t=!1){const o=carritoDeCompra.indexOf(e);carritoDeCompra[o].cantidad--,carritoDeCompra[o].cantidad<1&&borrarProductoDeCarritoDeCompra(e.id,e),t?mostrarCarritoDeCompras():actualizarInterfazCarritoCompra()}function crearModal(){esconderScroll();const e=document.createElement("DIV");e.classList.add("modal","modalCarrito"),ocultarHeader(),e.addEventListener("click",ocultarModal);const t=document.querySelector("body"),o=document.createElement("DIV");o.id="carritoDeCompras",o.innerHTML='\n    <div class="contenedorCarritoCompras"></div>\n    ',e.appendChild(o),t.appendChild(e)}function crearBotonBorrar(e,t,o){const a=document.createElement("BUTTON");a.classList.add("botonBorrar"),a.textContent="Elimina el producto",e.appendChild(a),a.addEventListener("click",(function(){carritoDeCompra.forEach((e=>{if(e.id===t){const t=carritoDeCompra.indexOf(e);carritoDeCompra.splice(t,1),delete o.cantidad,actualizarInterfazCarritoCompra()}}))}))}function borrarProductoDeCarritoDeCompra(e,t){carritoDeCompra.forEach((o=>{if(o.id===e){const e=carritoDeCompra.indexOf(o);carritoDeCompra.splice(e,1),delete t.cantidad,actualizarInterfazCarritoCompra()}}))}function ocultarModal(e){const t=document.querySelector(".modalCarrito");eventClass=e.target.closest(".contenedorCarritoCompras"),eventClass||(mostrarScroll(),t.remove(),mostrarHeader())}function mostrarScroll(){document.querySelector("body").style.overflowY="scroll"}function esconderScroll(){document.querySelector("body").style.overflowY="hidden"}function eventoMenu(){menu=document.querySelector(".hamburgerMenu"),menu.addEventListener("click",(function(){mostrarModal()}))}function mostrarModal(){ocultarHeader(),botonCerrar=document.querySelector(".icono"),modal=document.querySelector(".modal"),modal.classList.remove("ocultar"),modal.addEventListener("click",ocultarModalAndMostrarHeader)}function ocultarModalAndMostrarHeader(e){eventClass=e.target.closest(".menu"),eventClass||(modal.classList.add("ocultar"),mostrarHeader(),modal.removeEventListener("click",ocultarModalAndMostrarHeader))}function subrayarPaginaActual(){paginaActual=obtenerPaginaActual(),menuCampos=document.querySelectorAll(".menuCampo a"),menuCampos.forEach((e=>{e.attributes.href.value===paginaActual&&e.classList.add("subrayarAmarillo")}))}function obtenerPaginaActual(){return window.location.pathname}function ocultarHeader(){header=document.querySelector("header"),header.classList.add("ocultar")}function mostrarHeader(){header=document.querySelector("header"),header.classList.remove("ocultar")}function agregarFixed(){header=document.querySelector(".header"),sectionReferencia=document.querySelector(".nombre-pagina"),document.addEventListener("scroll",(function(){sectionReferencia.getBoundingClientRect().top<1?header.classList.add("positionFixed"):header.classList.remove("positionFixed")}))}function eventoInputs(){inputBoton=document.querySelectorAll("[name='user[contacto]']"),inputBoton.forEach((function(e){e.addEventListener("click",(function(e){target=e.target.id,mostrar(target)}))}))}function mostrar(e){div=document.querySelector(".contactoDiv"),"byTelefono"===e&&(div.innerHTML='\n        <label for="telefono">Numero de Celular</label>\n        <input id="telefono" type="tel" placeholder="Tu numero de celular" name="user[telefono]">\n        '),"byEmail"===e&&(div.innerHTML='\n        <label for="email">Correo</label>\n        <input id="email" type="email" placeholder="Tu correo electronico" name="user[email]">\n        ')}
//# sourceMappingURL=app.js.map
