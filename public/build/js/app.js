let formularioDatos,validado=!1,errorInput=!0,montoTotal=0,carritoDeCompra={productos:[],montoTotal:function(){let e=0;return this.productos.forEach((o=>{e+=parseInt(o.precio)*o.cantidad})),e}};const usuario={id:null,nombre:"",apellidos:"",datos_de_contacto:{telefono:"",email:"",direccion:"",ciudad:"",departamento:""}};let metodo_pago="",paso=1;const path=window.location.pathname;function iniciarApp(){if(eventoInputs(),eventoMenu(),subrayarPaginaActual(),eventoCarritoUserBoton(),"/"===path&&(agregarFixed(),eventoCuadros(),get_cuadros(),obtener_carrito_session(),evento_formulario_index()),"/carrito_de_compras"===path&&(obtener_carrito_session().then(mostrarCarritoDeCompras),agregarFixed(),crearOpcionesEnSelected(),tabs(),mostrarSeccion(),agregar_evento_botones_paginacion(),inputMetodosDePago(),formulario_evento()),"/crear_cuenta"===path)return eventos_crear_cuenta(),void ocultarHeader();if("/login"===path)return eventos_login(),void ocultarHeader();if("/reenviar_email"===path)return eventos_reenviar_confirmacion(),void ocultarHeader();if("/recuperar_password"===path)return eventos_recuperar_password(),void ocultarHeader();if("/reestablecer_password"!==path)"/producto"===path&&iniciar_producto(),"/productos"===path&&obtener_carrito_session();else{ocultarHeader();if(!document.getElementById("password"))return;eventos_reestablecer_password()}}function iniciar_producto(){mostrar_producto(),obtener_carrito_session(),evento_regresar()}function evento_regresar(){document.querySelector("#back-arrow").addEventListener("click",(e=>{e.preventDefault(),window.location.href=document.referrer}))}function mostrar_producto(){peticion_get(`/api/get/cuadro?id=${get_queryString("id")}`).then((e=>{if(e.respuesta){const o=e.producto,r={0:"No disponible",1:"Disponible"},t=document.querySelector(".producto_div"),{descripcion:a,disponible:n,id:c,imagen:i,nombre:d,precio:s,size:l}=o;t.innerHTML=`\n                <div class="producto_imagen">\n                    <img src="/img/productos/${i}" alt="imagen-producto">\n                </div>\n                <div class="info">\n                    <div class="producto_informacion">\n                        <p class="nombre">${d}</p>\n                        <p class="precio">$${parseInt(s).toLocaleString()}</p>\n                        <p class="descripcion"><span>Descripcion</span><br>${a}</p>\n                        <p class="size"><span>Tama√±o:</span> ${l}</p>\n                        <p class="disponible">${r[n]}</p>\n                    </div>\n                    <div class="acciones">\n                        <button  class="boton-accion btn-agregar">Agregar al carrito</button>\n                        <button  class="boton-accion btn-comprar">Comprar ahora</button>\n                    </div>\n                `,evento_botones_accion(o)}}))}async function obtener_carrito_session(){const e=await peticion_get("/api/session/get_carrito");e.resultado&&(carritoDeCompra.productos=e.productos)}async function peticion_get(e){try{const o=await fetch(e);return await o.json()}catch(e){console.log(e)}}function get_queryString(e){return new URLSearchParams(window.location.search).get(e)}function evento_botones_accion(e){document.querySelector(".btn-agregar").addEventListener("click",(function(){agregar_al_carrito(e),mostrarInterfazCarritoCompras()})),document.querySelector(".btn-comprar").addEventListener("click",(function(){agregar_al_carrito(e),guardar_carrito_compras_en_session().then(window.location.href="/carrito_de_compras")}))}function agregar_al_carrito(e){const o=carritoDeCompra.productos.find((o=>o.id===e.id));o?o.cantidad++:(e.cantidad=1,carritoDeCompra.productos=[...carritoDeCompra.productos,e])}function eventos_reestablecer_password(){document.querySelectorAll(".input").forEach((e=>{e.addEventListener("input",verificar_input)})),document.getElementById("recuperar_password").addEventListener("click",activar_evento_submit_en_crear_cuenta),document.getElementById("formulario").addEventListener("submit",reestablecer_password)}function reestablecer_password(e){e.preventDefault();const o=crear_objeto_con_datos_de_formulario(e);Object.entries(o).forEach((([e,o])=>{""===o&&crear_alerta_de_error_con_id(e)})),errorInput?resaltarErrores():(crear_alerta_de_cargando(),solicitar_reestablecer_password(o).then(eliminar_alerta_de_cargando).then(validar_respuesta_reestablecer_password))}async function solicitar_reestablecer_password(e){const o=new URLSearchParams(window.location.search).get("token");if(e.token_reset_password=o,o)try{const o=JSON.stringify(e),r="/api/login/reestablecer_password",t={method:"POST",body:o},a=await fetch(r,t);return await a.json()}catch(e){console.log(e)}}function validar_respuesta_reestablecer_password(e){const o=document.getElementById("respuesta_servidor");o.innerHTML="","exito"===e.respuesta?Swal.fire({title:"Buen trabajo!",text:`${e.mensaje}`,icon:"success",fontsize:"5rem"}).then((()=>{window.location.href="/login"})):o.innerHTML=`\n        <p>${e.mensaje}</p>\n        `}function eventos_recuperar_password(){document.querySelector("#email").addEventListener("input",verificar_input_login),document.querySelector("#recuperar_password").addEventListener("click",activar_evento_submit_en_crear_cuenta),document.querySelector("#formulario").addEventListener("submit",recuperar_password)}function recuperar_password(e){e.preventDefault();const o=crear_objeto_con_datos_de_formulario(e);Object.entries(o).forEach((([e,o])=>{""===o&&crear_alerta_de_error_con_id(e)})),errorInput?resaltarErrores():(crear_alerta_de_cargando(),solicitar_recuperar_password(o).then(eliminar_alerta_de_cargando).then(validar_respuesta_recuperar_password))}async function solicitar_recuperar_password(e){try{json=JSON.stringify(e);const o="/api/login/recuperar_email",r={method:"post",body:json},t=await fetch(o,r);return await t.json()}catch(e){console.log(e)}}function validar_respuesta_recuperar_password(e){const o=document.getElementById("respuesta_servidor");o.innerHTML="","exito"===e.respuesta?Swal.fire({title:"Correo enviado exitosamente!",text:`${e.mensaje}`,icon:"success",fontsize:"5rem"}).then((()=>{window.location.href="/login"})):o.innerHTML=`\n        <p>${e.mensaje}</p>\n        `}function eventos_reenviar_confirmacion(){document.querySelector("#email").addEventListener("input",verificar_input_login),document.querySelector("#boton_reenviar").addEventListener("click",activar_evento_submit_en_crear_cuenta),document.querySelector("#formulario").addEventListener("submit",reenviar_confirmacion)}function reenviar_confirmacion(e){e.preventDefault();const o=crear_objeto_con_datos_de_formulario(e);Object.entries(o).forEach((([e,o])=>{""===o&&crear_alerta_de_error_con_id(e)})),errorInput?resaltarErrores():(crear_alerta_de_cargando(),solicitar_reenviar_confirmacion(o).then(eliminar_alerta_de_cargando).then(validar_respuesta_reenviar_email))}function validar_respuesta_reenviar_email(e){const o=document.getElementById("respuesta_servidor");o.innerHTML="","exito"===e.respuesta?Swal.fire({title:"Correo reenviado exitosamente!",text:`${e.mensaje}`,icon:"success",fontsize:"5rem"}):o.innerHTML=`\n        <p>${e.mensaje}</p>\n        `}async function solicitar_reenviar_confirmacion(e){try{const o="/api/login/reenviar_email",r={method:"POST",body:JSON.stringify(e)},t=await fetch(o,r);return await t.json()}catch(e){console.log(e)}}function eventos_login(){document.getElementById("formulario").addEventListener("submit",logIn_usuario),document.getElementById("boton_ingresar").addEventListener("click",activar_evento_submit_en_crear_cuenta),document.querySelectorAll(".input").forEach((e=>{e.addEventListener("input",verificar_input_login)}))}function logIn_usuario(e){e.preventDefault();const o=crear_objeto_con_datos_de_formulario(e);Object.entries(o).forEach((([e,o])=>{""===o&&crear_alerta_de_error_con_id(e)})),errorInput?resaltarErrores():(crear_alerta_de_cargando(),enviar_solicitud_login(o).then(eliminar_alerta_de_cargando).then(validar_respuesta_login))}function validar_respuesta_login(e){if("exitoso"===e.respuesta){if(!0===e.sesionInfo.admin)return void(window.location.href="/admin/home");window.location.href="/"}else console.log(e),e.mensaje.includes("email")?crear_alerta_de_error_con_id("email",e.mensaje,!0):crear_alerta_de_error_con_id("password",e.mensaje,!0)}async function enviar_solicitud_login(e){try{const o={method:"POST",body:JSON.stringify(e)},r="/api/login/login",t=await fetch(r,o);return await t.json()}catch(e){console.log(e)}}function verificar_input_login(e){const o=e.target.value,r=document.querySelector(`#error${e.target.id}`),t=e.target.id;if(""===o)return void crear_alerta_de_error_con_id(t);if("email"===t){if(!validarEmail(o))return void crear_alerta_de_error_con_id(t,"Woops! parece que tu email no es valido",!0)}r&&r.remove();document.querySelector(".errorInput")||(errorInput=!1)}function validarEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function eventos_crear_cuenta(){document.getElementById("formulario").addEventListener("submit",crear_cuenta);document.getElementById("boton_crear_cuenta").addEventListener("click",activar_evento_submit_en_crear_cuenta),document.querySelectorAll(".input").forEach((e=>{e.addEventListener("input",verificar_input)}))}function crear_alerta_de_error_con_id(e,o="",r=!1){errorInput=!0;const t=document.querySelector(`#error${e}`),a=document.getElementById(e),n=document.createElement("P");n.setAttribute("id",`error${e}`),n.classList.add("errorInput"),n.textContent="**Necesitamos que llenes este campo**",r&&(n.textContent=`**${o}**`),a.insertAdjacentElement("afterend",n),t&&t.remove()}function verificar_input(e){const o=e.target.value,r=document.querySelector(`#error${e.target.id}`),t=e.target.id;if(""===o)return void crear_alerta_de_error_con_id(t);if("email"===t){if(!validarEmail(o))return void crear_alerta_de_error_con_id(t,"Woops! parece que tu email no es valido",!0)}if("password"===t){if(!verificar_password(t))return}if("password_confirmar"===t){if(o!==document.getElementById("password").value)return void crear_alerta_de_error_con_id(t,"Las contrase√±as no coinciden",!0)}r&&r.remove();document.querySelector(".errorInput")||(errorInput=!1)}function verificar_password(e){const o=document.querySelector(`#${e}`),r=o.value.length,t=document.querySelector(`#error${e}`);if(r<6){const r=document.createElement("P");return r.setAttribute("id",`error${e}`),r.classList.add("errorInput"),r.textContent="**La contrase√±a debe tener minimo 6 caracteres**",o.insertAdjacentElement("afterend",r),t&&t.remove(),!1}return!0}function crear_cuenta(e){e.preventDefault();const o=crear_objeto_con_datos_de_formulario(e);Object.entries(o).forEach((([e,o])=>{""===o&&crear_alerta_de_error_con_id(e)})),errorInput?resaltarErrores():(crear_alerta_de_cargando(),enviar_formulario_para_crear_cuenta(o).then(eliminar_alerta_de_cargando).then(validar_respuesta_envio_formulario_crear_cuenta))}function crear_alerta_de_cargando(){insertar_alerta_cargando(crear_modal_en_body())}function eliminar_alerta_de_cargando(e){return document.getElementById("modal").remove(),e}function crear_modal_en_body(){const e=document.createElement("DIV"),o=document.querySelector("body");return e.classList.add("modal","modal_crear_cuenta"),e.id="modal",o.appendChild(e),e}function insertar_alerta_cargando(e){const o=document.createElement("DIV");o.classList.add("alertaCargando"),o.innerHTML='<i class="fa-solid fa-spinner fa-2xl"></i>',e.appendChild(o)}function resaltarErrores(){document.querySelectorAll(".errorInput").forEach((e=>{e.classList.add("resaltarError"),setTimeout((()=>{e.classList.remove("resaltarError")}),500)}))}function validar_respuesta_envio_formulario_crear_cuenta(e){if(e.respuesta){document.querySelector("#mensaje").innerHTML="",Swal.fire({title:"Buen trabajo!",text:`${e.mensaje}`,icon:"success",fontsize:"5rem"}).then((()=>{window.location.href="/login"}))}else{const o=document.querySelector("#mensaje");o.innerHTML="",e.alertas.error.forEach((e=>{const r=document.createElement("P");r.textContent=e,r.classList.add("mensaje_de_error"),o.appendChild(r)}))}}async function enviar_formulario_para_crear_cuenta(e){try{getFechaActualFormateada();const o="/api/login/crear_cuenta",r={method:"post",body:JSON.stringify(e)},t=await fetch(o,r);return await t.json()}catch(e){console.log(e)}}function activar_evento_submit_en_crear_cuenta(){const e=document.getElementById("formulario"),o=new Event("submit",{bubbles:!0,cancelable:!0});e.dispatchEvent(o)}function contenedorMetodoPagoEvento(){document.querySelectorAll(".contenedor_metodo_pago").forEach((e=>{e.addEventListener("click",(e=>{const o=e.target.dataset.metodoPago;metodo_pago=o,mostrar_informacion_metodo_pago()}))}))}function inputMetodosDePago(){document.querySelectorAll(".input_radio_metodo_pago").forEach((e=>{e.addEventListener("click",(e=>{const o=e.target.dataset.metodoPago;metodo_pago=o,mostrar_informacion_metodo_pago()}))}))}function mostrar_informacion_metodo_pago(){const e=document.createElement("DIV");e.classList.add("contenedor_crear_pedido");const o=document.querySelector(".contenedor_crear_pedido");if(o&&o.remove(),"transferencia"===metodo_pago){const o=document.querySelector("[data-metodo-pago='transferencia'");return e.innerHTML='<button class="boton_crear_pedido boton">Terminar pedido</button>\n            <p class="crear_pedido_descripcion">Listo... Selecciona crear pedido para\n                crear la orden, una vez tengas la orden realizada, solo falta realizar\n                el pago y empezaremos a realizar y despachar tu pedido... üòé\n            </p>',o.appendChild(e),metodo_pago="transferencia",void document.querySelector(".boton_crear_pedido").addEventListener("click",crear_pedido)}if("pse"===metodo_pago){const o=document.querySelector("[data-metodo-pago='pse'");return e.innerHTML="<p>Todavia no hemos habilitado transferencia PSE... esperalo pronto :D</p>",metodo_pago="pse",void o.appendChild(e)}}function obtenerValueElementById(e){return document.getElementById(e).value}async function crear_pedido(){try{const e=getFechaActualFormateada(),o={carritoDeCompra:carritoDeCompra.productos,pedidos:{fecha:e,direccion:formularioDatos.direccion,departamento:formularioDatos.departamento,ciudad:formularioDatos.ciudad,metodo_pago:metodo_pago,informacion_adicional:formularioDatos.informacion_extra},usuario:{nombre:formularioDatos.nombre,apellido:formularioDatos.apellido,email:formularioDatos.email,telefono:formularioDatos.telefono,cedula:formularioDatos.cedula}},r="/api/crear_orden";jsonData=JSON.stringify(o);const t={method:"POST",body:jsonData};console.log(o),crear_alerta_de_cargando();const a=await fetch(r,t),n=await a.json();eliminar_alerta_de_cargando(),n.exito&&(carritoDeCompra.productos=n.carrito,Swal.fire({icon:"success",title:"Pedido creado",text:"El pedido ha sido guardado con exito",button:"OK"}).then((()=>{mostrar_instrucciones_despues_de_pago(n)})))}catch(e){console.log(e),Swal.fire({icon:"error",title:"Ha habido un error",text:"El pedido no se ha podido crear.."})}}function mostrar_instrucciones_despues_de_pago(e){document.querySelector("main").innerHTML=`\n    <h1>Gracias por tu compra!</h1>\n    <div class="div_instrucciones_pago contenedor">\n    <h2>Instrucciones a seguir</h2>\n    <div class="contenedorInstrucciones">\n        <p>Hemos enviado un correo electronico con las siguientes instrucciones, porfavor revisar la bandeja de spam: </p>\n        <p>Consigna a nuestra cuenta bancolombia #: <span>412514</span></p>\n        <p>Manda un screenshot a nuestro wp #124123123312 con el pedido # <span>${e.pedidoId}</span></p>\n        <p>Recibe tus productos en la puerta de tu casa...!</p>\n    </div>\n    <div class="resumenCompra"></div>\n    <h2>Resumen de tu pedido</h2>\n    <p>El pedido quedo a nombre de : <span> ${e.nombre} </span>  </p>\n    <p>El costo total a pagar es de : <span> $${parseInt(e.costo_total).toLocaleString()} </span></p>\n    <ul class="lista-productos" id="lista-productos">\n        <p>Los productos que te mandaremos son:</p>\n    </ul>\n    <p>La direccion a la que te mandaremos los productos es: <span>${e.direccion}</span> </p>\n    </div>\n    `;const o=document.querySelector("#lista-productos");e.productos.forEach((e=>{const r=document.createElement("LI");r.innerHTML=`<p><span>${e.nombre}</span> x${e.cantidad}</p>`,o.appendChild(r)}))}function formulario_evento(){document.getElementById("formulario_carrito_de_compras").addEventListener("submit",(e=>{e.preventDefault();const o=crear_objeto_con_datos_de_formulario(e);validar_formulario_informacion_para_pedido(o).then((e=>{e?(validado=!0,formularioDatos=o,cambiarSeccionAdelante()):validado=!1}))}))}function crear_objeto_con_datos_de_formulario(e){return Object.fromEntries(new FormData(e.target))}async function validar_formulario_informacion_para_pedido(e){try{jsonData=JSON.stringify(e);const o="/api/validar_formulario",r={method:"POST",body:jsonData};console.log(e);const t=await fetch(o,r),a=await t.json();if(!a.error)return!0;{const e=document.querySelector("#alertas");for(;e.firstChild;)e.removeChild(e.firstChild);a.error.forEach((o=>{const r=document.createElement("P");return r.classList.add("alerta","error"),r.textContent=o,e.appendChild(r),!1})),setTimeout((()=>{for(;e.firstChild;)e.removeChild(e.firstChild)}),5e3);document.querySelector(".alerta").scrollIntoView({behavior:"smooth"})}}catch(e){const o=document.querySelector("#alertas"),r=document.createElement("P");r.textContent=e,o.appendChild(r)}}function tabs(){document.querySelectorAll(".tabs button").forEach((e=>{e.addEventListener("click",(function(e){if("3"===e.target.dataset.paso){if(!activar_evento_submit_en_formulario_carrito_compras())return}paso=parseInt(e.target.dataset.paso),mostrarSeccion()}))}))}function mostrarSeccion(){let e=document.querySelector(".actual");const o=document.querySelector("#anterior"),r=document.querySelector("#siguiente");if(3===paso){const e=document.querySelector("#alertas");for(;e.firstChild;)e.removeChild(e.firstChild);if(!validado){return void(document.getElementById("alertas").innerHTML="<p class='alerta error'> Faltan datos por rellenar</p>")}console.log("el usuario esta validado, pasando a la seccion 3"),r.classList.add("hidden")}if(e){e.classList.remove("actual"),e.classList.add("ocultar");const o=document.querySelector(".hidden");o&&o.classList.remove("ocultar")}1===paso&&o.classList.add("hidden"),2===paso&&(o.classList.remove("hidden"),r.classList.remove("hidden"));let t=document.querySelector(`#paso-${paso}`);t.classList.add("actual"),t.classList.remove("ocultar")}function crearOpcionesEnSelected(){const e=document.querySelector("#departamento");getDepartamentosColombia().then((o=>{o.forEach((o=>{const r=document.createElement("OPTION");r.textContent=o.name,r.value=o.name,r.dataset.departamentoId=o.id,e.appendChild(r)}))})),e.addEventListener("change",eventoSelect)}function eventoSelect(e){get_ciudades_de_un_departamento(e.target.options[e.target.selectedIndex].attributes["data-departamento-id"].value).then((e=>{crear_options_de_ciudad(e),console.log(e)}))}function crear_options_de_ciudad(e){const o=document.querySelector("#ciudad");e.forEach((e=>{const r=document.createElement("OPTION");r.textContent=e.name,r.value=e.name,r.dataset.ciudadId=e.id,o.appendChild(r)})),o.removeAttribute("disabled")}async function get_ciudades_de_un_departamento(e){try{const o=`https://api-colombia.com/api/v1/Department/${e}/cities`,r=await fetch(o);return await r.json()}catch(e){console.log(e)}}document.addEventListener("DOMContentLoaded",(function(){iniciarApp()}));let departamentos={};async function getDepartamentosColombia(){try{const e="https://api-colombia.com/api/v1/Department",o=await fetch(e);return await o.json()}catch(e){console.log(e)}}async function recuperarCarritoCompras(){try{const e="/api/cuadros/guardar_carrito_compras",o=await fetch(e),r=await o.json();carritoDeCompra=r.carritoDeCompra,montoTotal=r.montoTotal,mostrarCarritoDeCompras()}catch(e){console.log(e)}}function mostrarCarritoDeCompras(){guardar_carrito_compras_en_session();const e=document.querySelector(".contenedorProductosFormulario"),o=document.querySelector("#tbody");for(;o.firstChild;)o.removeChild(o.firstChild),e.firstChild&&e.removeChild(e.firstChild);if(0===carritoDeCompra.productos.length){const o=document.createElement("P");return o.classList.add("parrafoCarritoVacio"),o.innerHTML="El carrito esta vacio ... <br /> Lo sentimos selecciona algo para poder seguir con alguna compra ...  üò≠",void e.appendChild(o)}const r=document.getElementById("tbody");carritoDeCompra.productos.forEach((e=>{const{id:o,nombre:t,precio:a,descripcion:n,size:c,disponible:i,imagen:d,cantidad:s}=e;document.createElement("DIV").classList.add("interfazCampo");const l=document.createElement("P");l.textContent=t,l.classList.add("nombre-producto");const u=document.createElement("P");u.textContent=`$${parseInt(a).toLocaleString()}`,u.classList.add("precio-producto");const m=document.createElement("P");m.textContent=`Cantidad: ${s}`,m.classList.add("cantidad_producto");const p=document.createElement("BUTTON");p.classList.add("botonChico"),p.textContent="+",p.addEventListener("click",(function(){agregarCantidad(e,!0)}));const _=document.createElement("BUTTON");_.classList.add("botonChicoRojo"),_.textContent="-",_.addEventListener("click",(function(){restarCantidad(e,!0)}));const f=document.createElement("P");f.innerHTML=`<span>Tama√±o: </span> ${c}`;const g=document.createElement("P");g.classList.add("descripcion-producto"),g.textContent=n;const v=document.createElement("DIV");v.classList.add("iconoDiv");const h=document.createElement("I");h.classList.add("fa-solid","fa-trash"),h.dataset.idProducto=o,h.addEventListener("click",(function(e){eliminarProducto(e.target.dataset.idProducto)})),v.appendChild(h);const C=document.createElement("DIV");C.classList.add("infoProductoCarrito"),C.appendChild(l),C.appendChild(f),C.appendChild(g);const b=document.createElement("DIV");b.classList.add("cantidad_producto_div"),b.appendChild(p),b.appendChild(_),b.appendChild(v);const E=document.createElement("IMG");E.src=`/img/productos/${d}`;const y=a*s,S=document.createElement("P");S.textContent=`$${y.toLocaleString()}`,S.classList.add("precio-total-produto");const L=document.createElement("TR"),D=document.createElement("TD");D.classList.add("tabla_DetallesDelProducto"),D.appendChild(E),D.appendChild(C);const w=document.createElement("TD");w.appendChild(m),w.appendChild(b);const I=document.createElement("TD");I.appendChild(u);const q=document.createElement("TD");q.appendChild(S),L.appendChild(D),L.appendChild(w),L.appendChild(I),L.appendChild(q),r.appendChild(L)}));const t=document.createElement("P");t.classList.add("parrafoMontoTotal"),t.innerHTML=`<span>Monto Total:</span> $${carritoDeCompra.montoTotal().toLocaleString()} COP`,e.appendChild(t)}function agregar_evento_botones_paginacion(){anterior=document.querySelector("#anterior"),siguiente=document.querySelector("#siguiente"),siguiente.addEventListener("click",cambiarSeccionAdelante),anterior.addEventListener("click",cambiarSeccionAtras)}function activar_evento_submit_en_formulario_carrito_compras(){const e=document.getElementById("formulario_carrito_de_compras"),o=new Event("submit",{bubbles:!0,cancelable:!0});e.dispatchEvent(o)}function cambiarSeccionAdelante(e){(2!==paso||(activar_evento_submit_en_formulario_carrito_compras(),validado))&&3!==paso&&(paso++,mostrarSeccion())}function cambiarSeccionAtras(){1!==paso&&(paso--,mostrarSeccion())}function eliminarProducto(e){carritoDeCompra.productos.forEach((o=>{if(o.id===e){const e=carritoDeCompra.productos.indexOf(o.id);carritoDeCompra.productos.splice(e,1),console.log(carritoDeCompra),mostrarCarritoDeCompras()}})),guardar_carrito_compras_en_session()}async function guardar_carrito_compras_en_session(){options={method:"post",body:JSON.stringify(carritoDeCompra.productos)};try{const e=await fetch("/api/session/guardar_carrito",options);return e.json()}catch(e){console.log(e)}}async function guardar_carrito_en_session(){try{const e=getFechaActualFormateada(),o={carritoDeCompra:carritoDeCompra,userData:{usuarioID:usuario.id},fecha:e,status:"pendiente",monto_total:montoTotal,metodo_pago:metodo_pago},r="/api/cuadros/guardar_carrito_compras";jsonData=JSON.stringify(o);const t={method:"POST",body:jsonData};console.log(o);const a=await fetch(r,t),n=await a.json();console.log(n),n.resultado&&Swal.fire({icon:"success",title:"Pedido creado correctamente",text:"El pedido ah sido creado crrectamente, a continuacion lee lo siguiente",button:"OK"}).then((()=>{window.location.href="/carrito_de_compras"}))}catch(e){console.log(e),Swal.fire({icon:"error",title:"Ha habido un error",text:"El pedido no se ha podido crear.."})}}function getFechaActualFormateada(){const e=new Date,o=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),t=String(e.getDate()).padStart(2,"0");String(e.getHours()).padStart(2,"0"),String(e.getMinutes()).padStart(2,"0"),String(e.getSeconds()).padStart(2,"0");return`${o}-${r}-${t}`}async function get_cuadros(){try{const e="/api/cuadros/getcuadros?n=6",o=await fetch(e);imprimir_cuadros(await o.json())}catch(e){console.log(e)}}function imprimir_cuadros(e){e.forEach((e=>{const{descripcion:o,disponible:r,id:t,imagen:a,nombre:n,precio:c,size:i}=e,d=document.getElementById("cuadros"),s=document.createElement("DIV");s.classList.add("cuadro"),s.onclick=function(){window.location.href=`/producto?id=${t}`};const l=document.createElement("DIV");l.classList.add("imagenCuadroDiv"),l.style.backgroundImage=`url(/img/productos/${a})`;const u=document.createElement("DIV");u.classList.add("cuadro-info"),u.dataset.idCuadro=t;const m=document.createElement("P");m.classList.add("nombre-cuadro"),m.textContent=n;const p=document.createElement("P");p.classList.add("precio-cuadro"),p.textContent=`$${parseFloat(c).toLocaleString()}`,console.log(),u.appendChild(m),u.appendChild(p),s.appendChild(l),s.appendChild(u),d.appendChild(s)}))}function mostrar_cuadro(e){crear_modal();document.createElement("IMG").href=`/img/productos/${e.imagen}`,console.log(e)}function eventoCuadros(){cuadros=document.querySelectorAll(".imagenCuadroDiv"),cuadros.forEach((e=>{e.addEventListener("mouseenter",crearBotonComprar),e.addEventListener("mouseleave",eliminarBotonComprar)}))}function crearBotonComprarActual(e,o){const r=document.createElement("DIV"),t=document.createElement("BUTTON");t.classList.add("boton"),t.textContent="Agregar al carrito",r.appendChild(t),e.appendChild(r),t.addEventListener("click",(function(){agregarAlCarrito(o)}))}function agregarAlCarrito(e){if("cantidad"in e){const{id:o}=e;let r;carritoDeCompra.forEach((e=>{o===e.id&&(r=e)}));const t=carritoDeCompra.indexOf(r);carritoDeCompra[t].cantidad=carritoDeCompra[t].cantidad+1}else e.cantidad=1,carritoDeCompra.push(e);actualizarInterfazCarritoCompra()}function removeInterfazDinamico(e,o){o.remove(),e.target.removeEventListener("click",removeInterfaz)}function eventoCarritoUserBoton(){const e=document.querySelector(".carritoCompra");document.querySelector(".userBoton");e.addEventListener("click",mostrarInterfazCarritoCompras)}function mostrarInterfazCarritoCompras(){actualizarInterfazCarritoCompra();const e=document.querySelector(".modalCarrito"),o=document.querySelector("#carritoDeCompras");e.appendChild(o),esconderScroll()}function actualizarInterfazCarritoCompra(){guardar_carrito_compras_en_session();const e=document.querySelector(".modalCarrito");e&&e.remove(),crearModal();const o=document.querySelector(".contenedorCarritoCompras");if(carritoDeCompra.productos.length<1){const e=document.createElement("P");return e.classList.add("parrafoCarritoVacio"),e.textContent="El carrito esta vacio ...",void o.appendChild(e)}for(;o.firstChild;)o.removeChild(o.firstChild);carritoDeCompra.productos.forEach((e=>{const{id:r,nombre:t,precio:a,descripcion:n,size:c,disponible:i,imagen:d,cantidad:s}=e,l=document.createElement("DIV");l.classList.add("interfazCampo");const u=document.createElement("P");u.textContent=t,u.classList.add("nombre-producto");const m=document.createElement("P");m.textContent=`$${parseInt(a).toLocaleString()}`,m.classList.add("precio-producto");const p=document.createElement("P");p.textContent=`Cantidad: ${s}`;const _=document.createElement("BUTTON");_.classList.add("botonChico"),_.textContent="+",_.onclick=function(){agregarCantidad(e)};const f=document.createElement("BUTTON");f.classList.add("botonChicoRojo"),f.textContent="-",f.addEventListener("click",(function(){restarCantidad(e),actualizarInterfazCarritoCompra()}));const g=document.createElement("DIV");g.classList.add("infoProductoCarrito"),g.appendChild(u),g.appendChild(m),g.appendChild(p),g.appendChild(_),g.appendChild(f),crearBotonBorrar(g,r,e);const v=document.createElement("IMG");v.src=`/img/productos/${d}`,l.appendChild(g),l.appendChild(v),o.appendChild(l)}));const r=document.createElement("P");r.classList.add("parrafoMontoTotal"),r.textContent=`Monto total: $${carritoDeCompra.montoTotal().toLocaleString()}`,o.appendChild(r);const t=document.createElement("BUTTON");t.classList.add("boton"),t.textContent="Comprar",t.addEventListener("click",comprar_carrito),o.appendChild(t)}function comprar_carrito(){guardar_carrito_compras_en_session().then(window.location.href="/carrito_de_compras")}function sumarProductosCarrito(){let e=0;return carritoDeCompra.forEach((o=>{let r=parseInt(o.precio)*o.cantidad;e+=r})),e}function actualizar_resumen_de_carrito_compras(){}function agregarCantidad(e,o=!1){const r=carritoDeCompra.productos.indexOf(e);if(carritoDeCompra.productos[r].cantidad++,o)return console.log(carritoDeCompra.productos),void mostrarCarritoDeCompras();actualizarInterfazCarritoCompra()}function restarCantidad(e,o=!1){const r=carritoDeCompra.productos.indexOf(e);carritoDeCompra.productos[r].cantidad--,carritoDeCompra.productos[r].cantidad<1&&borrarProductoDeCarritoDeCompra(e.id,e),o?mostrarCarritoDeCompras():actualizarInterfazCarritoCompra()}function crearModal(){esconderScroll();const e=document.createElement("DIV");e.classList.add("modal","modalCarrito"),ocultarHeader(),e.addEventListener("click",ocultarModal);const o=document.querySelector("body"),r=document.createElement("DIV");r.id="carritoDeCompras",r.innerHTML='\n    <div class="contenedorCarritoCompras"></div>\n    ',e.appendChild(r),o.appendChild(e)}function crearBotonBorrar(e,o,r){const t=document.createElement("BUTTON");t.classList.add("botonBorrar"),t.textContent="Elimina el producto",e.appendChild(t),t.addEventListener("click",(function(){carritoDeCompra.productos.forEach((e=>{if(e.id===o){const o=carritoDeCompra.productos.indexOf(e);carritoDeCompra.productos.splice(o,1),delete r.cantidad,actualizarInterfazCarritoCompra()}}))}))}function borrarProductoDeCarritoDeCompra(e,o){carritoDeCompra.productos.forEach((o=>{if(o.id===e){const e=carritoDeCompra.productos.indexOf(o);carritoDeCompra.productos.splice(e,1)}}))}function ocultarModal(e){const o=document.querySelector(".modalCarrito");eventClass=e.target.closest(".contenedorCarritoCompras"),eventClass||(mostrarScroll(),o.remove(),mostrarHeader())}function mostrarScroll(){document.querySelector("body").style.overflowY="scroll"}function esconderScroll(){document.querySelector("body").style.overflowY="hidden"}function evento_formulario_index(){document.querySelector(".formulario").addEventListener("submit",(function(e){e.preventDefault();enviar_formulario_para_cuadro_personalizado(crear_objeto_con_datos_de_formulario(e))}))}async function enviar_formulario_para_cuadro_personalizado(e){const o=new FormData;o.append("nombre",e.nombre),o.append("apellido",e.apellido),o.append("contacto",e.contacto),o.append("telefono",e.telefono),o.append("email",e.email),o.append("mensaje",e.mensaje);const r={method:"POST",body:o};try{crear_alerta_de_cargando();const e=await fetch("/api/formulario_cuadro_personalizado",r),o=await e.json();eliminar_alerta_de_cargando(),"exito"===o.tipo?(mostrar_alerta("exito",o.mensaje,".informacionPersonal legend"),document.querySelector('[type="submit"]').remove()):o.alertas.error.forEach((e=>{mostrar_alerta("error",e,".informacionPersonal legend")})),console.log(o)}catch(e){}}function mostrar_alerta(e,o,r){const t=document.createElement("DIV");t.classList.add("alerta",e),t.textContent=o;const a=document.querySelector(r);a.parentElement.insertBefore(t,a),setTimeout((()=>{t.remove()}),4e3)}function eventoMenu(){menu=document.querySelector(".hamburgerMenu"),menu.addEventListener("click",(function(){mostrarMenu()}))}function mostrarMenu(){ocultarHeader();const e=crear_modal();esconderScroll(),e.innerHTML='\n    <div class="menu">\n            <div class="menuHeader">\n                <i id="cerrar_menu" class="fa-solid fa-x fa-2xl icono"></i>\n                <div class="menuCampo">\n                    <a href="/">Home</a>\n                </div>\n                <div class="menuCampo">\n                    <a href="/productos">Todos los Productos</a>\n                </div>\n                <div class="menuCampo">\n                    <a href="/carrito_de_compras">Carrito de compra</a>\n                </div>\n                \n            </div>\n            <div class="menuFooter">\n                <div class="redes contenedor">\n                    <a href="https://www.facebook.com/profile.php?id=61559826170800"><i class="fa-brands fa-square-facebook fa-2xl"></i></i></a>    \n                    <a href="https://www.instagram.com/cyberr.art/"><i class="fa-brands fa-square-instagram fa-2xl"></i></a>    \n                    <a href="https://www.tiktok.com/@cyberartcraft"><i class="fa-brands fa-tiktok fa-2xl"></i></a>    \n                </div>\n            </div>\n        </div>\n    ',e.addEventListener("mousedown",(function(e){evento_eliminar_modal(e,".menu")})),botonCerrar=document.querySelector("#cerrar_menu"),botonCerrar.addEventListener("click",eliminar_modal_and_mostrar_header)}function crear_modal(){const e=document.querySelector("body"),o=document.createElement("DIV");o.classList.add("modal"),o.innerHTML='\n    <div class="modal_contenido">\n\n    </div>\n    ',e.appendChild(o);return document.querySelector(".modal_contenido")}function evento_eliminar_modal(e,o){eventClass=e.target.closest(o),eventClass||(eliminar_modal(),mostrarHeader(),mostrarScroll())}function eliminar_modal(){document.querySelector(".modal").remove(),mostrarHeader()}function eliminar_modal_and_mostrar_header(){eliminar_modal(),mostrarHeader(),mostrarScroll()}function subrayarPaginaActual(){paginaActual=obtenerPaginaActual(),menuCampos=document.querySelectorAll(".menuCampo a"),menuCampos.forEach((e=>{e.attributes.href.value===paginaActual&&e.classList.add("subrayarAmarillo")}))}function obtenerPaginaActual(){return window.location.pathname}function ocultarHeader(){header=document.querySelector("header"),header.classList.add("ocultar")}function mostrarHeader(){header=document.querySelector("header"),header.classList.remove("ocultar")}function agregarFixed(){const e=document.querySelector(".header"),o=document.querySelector(".nombre-pagina"),r=document.querySelector("main");o&&document.addEventListener("scroll",(function(){o.getBoundingClientRect().top<1?(e.classList.add("positionFixed"),r.classList.add("padding-for-fixedHeader")):(e.classList.remove("positionFixed"),r.classList.remove("padding-for-fixedHeader"))}))}function eventoInputs(){inputBoton=document.querySelectorAll("[name='contacto']"),inputBoton.forEach((function(e){e.addEventListener("click",(function(e){target=e.target.id,mostrar(target)}))}))}function mostrar(e){div=document.querySelector(".contactoDiv"),"byTelefono"===e&&(div.innerHTML='\n        <label for="telefono">Numero de Celular</label>\n        <input id="telefono" type="tel" placeholder="Tu numero de celular" name="telefono">\n        '),"byEmail"===e&&(div.innerHTML='\n        <label for="email">Correo</label>\n        <input id="email" type="email" placeholder="Tu correo electronico" name="email">\n        ')}
//# sourceMappingURL=app.js.map
